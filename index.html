<!DOCTYPE html>
<html lang="en">
  <head> 
    <meta charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>

    <!--Button to change page--->
    <div class="page-btn-container">
      <button type="button" id="page-btn1">1</button>
      <button type="button" id="page-btn2">2</button>
      <button type="button" id="page-btn3">3</button>
      <button type="button" id="page-btn4">4</button>
    </div>

    <!--Start form-->
    <form method="post" id="form">

    <!--- Header -->
    <p id="idNumber">No. <input type="number" name="Number"></p>
    <h1>Long-Term Outcomes of Post-AKI Survivors</h1>
    <section id="section1">
      <table>
        <!--Part I-->
        <caption>Part I: Review History and Diagnosis</caption>
          <!--Row 1-->
        <tr>
          <td>Sex</td>
          <td colspan="3"><input type="radio" value="male" name="Sex">1. Male <input type="radio" value="female" name="Sex">2. Female</td>
        </tr>
          <!--Row 2-->
        <tr>
          <td><label for="age">Age (years old)</label></td>
          <td><input type="number" placeholder="..." id="age" name="Age"></td>
          <td>DOB</td>
          <td style="text-align:center"><input type="text" name="DOB"></td>
        </tr>
          <!--Row 3-->
        <tr>
          <td>Height (cm)</td>
          <td><input type="number" name="Height" placeholder="..."> </td>
          <td>Weight (kg)</td>
          <td><input type="number" name="Weight" placeholder="..."> </td>
        </tr>
          <!--Row 4-->
        <tr>
          <td>Hospital Admission</td>
          <td colspan="3" style="text-align:left"><input type="text" name="Hospital Admission"></td>
        </tr>
          <!--Row 5-->
        <tr>
          <td>Discharge date</td>
          <td colspan="3" style="text-align:left"><input type="text" name="Discharge date"></td>
        </tr>
          <!--Row 6 Admission diagnosis-->
        <tr>
          <td>Admission diagnosis</td>
          <td colspan="3"><input type="text" style="width: 100%; text-align:left" name="Admission diagnosis"></td>
        </tr>
          <!--Row 7-->
        <tr>
          <td rowspan="4">Cause of admission</td>
          <td colspan="3">
            <span><input type="radio" name="Cause of admission" value="Pulmonary">1. Pulmonary </span>
            <span><input type="radio" name="Cause of admission" value="Endocrine">2. Endocrine </span>
            <span><input type="radio" name="Cause of admission" value="Cardiovascular">3. Cardiovascular </span>
          </td>
        </tr>
        <tr>
          <td colspan="3">
            <input type="radio" name="Cause of admission" value="Genitourinary">4. Genitourinary 
            <input type="radio" name="Cause of admission" value="Hematology">5. Hematology 
            <input type="radio" name="Cause of admission" value="Neurology">6. Neurology 
          </td>
        </tr>
        <tr>
          <td colspan="3">
            <input type="radio" name="Cause of admission" value="Skin/soft tissue infection">7. Skin/soft tissue infection 
            <input type="radio" name="Cause of admission" value="Surgery">8. Surgery 
            <input type="radio" name="Cause of admission" value="Systemic infection">9. Systemic infection
          </td>
        </tr>
        <tr>
          <td colspan="3">
            <input type="radio" name="Cause of admission" value="Gastrointestinal">10. Gastrointestinal 
            <input type="radio" name="Cause of admission" value="Ob/Gyne">11. Ob/Gyne 
            <input type="radio" name="Cause of admission" value="Other">12. Other 
          </td>
        </tr>
        <!--Row 8-->
        <tr>
          <td>ICU admission</td>
          <td colspan="3">
            <input type="radio" value="yes" name="ICU admission">1. Yes 
            <input type="radio" value="no" name="ICU admission">2. No
          </td>
        </tr>
        <!--Row 9-->
        <tr>
          <td>Primary ward</td>
          <td colspan="3">
            <input type="radio" value="Medical" name="Primary ward">1. Medical 
            <input type="radio" value="Surgical" name="Primary ward">2. Surgical
            <input type="radio" value="Other" name="Primary ward">3. Other
          </td>
        </tr>
        <!--Row 10  Comorbidity-->
        <tr>
          <td colspan="4">
            <strong>Comorbidity</strong>
          </td>
        </tr>
        <!--Row 11-->
        <tr>
          <td>DM type 2 </td>
          <td colspan="3">
            <input type="radio" value="yes" name="DM type 2">1. Yes 
            <input type="radio" value="no" name="DM type 2">2. No
          </td>
        </tr>

        <!--Row 12-->
        <tr>
          <td>Hypertension </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Hypertension">1. Yes 
            <input type="radio" value="no" name="Hypertension">2. No
          </td>
        </tr>

        <!--Row 13-->
        <tr>
          <td>Dyslipidemia </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Dyslipidemia">1. Yes 
            <input type="radio" value="no" name="Dyslipidemia">2. No
          </td>
        </tr>

        <!--Row 14-->
        <tr>
          <td>Chronic kidney disease </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Chronic kidney disease">1. Yes 
            <input type="radio" value="no" name="Chronic kidney disease">2. No
          </td>
        </tr>

        <!--Row 15-->
        <tr>
          <td>Ischemic heart disease </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Ischemic heart disease">1. Yes 
            <input type="radio" value="no" name="Ischemic heart disease">2. No
          </td>
        </tr>

        <!--Row 16-->
        <tr>
          <td>Heart failure </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Heart failure">1. Yes 
            <input type="radio" value="no" name="Heart failure">2. No
          </td>
        </tr>

        <!--Row 17-->
        <tr>
          <td>Stroke </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Stroke">1. Yes 
            <input type="radio" value="no" name="Stroke">2. No
          </td>
        </tr>

        <!--Row 18-->
        <tr>
          <td>Malignancy </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Malignancy">1. Yes 
            <input type="radio" value="no" name="Malignancy">2. No
          </td>
        </tr>

        <!--Row 19-->
        <tr>
          <td>Other </td>
          <td colspan="3"><input type="text" style="width: 100%; text-align:left" placeholder="Please identify" name="Other"></td>
        </tr>

        <!--Row 20  Past history-->
        <tr>
          <td colspan="4">
            <strong>Past history</strong>
          </td>
        </tr>

        <!--Row 21-->
        <tr>
          <td>Smoking </td>
          <td colspan="3">
            <span>
              <input type="radio" value="yes" name="Smoking">1. Yes 
              <input type="radio" value="no" name="Smoking">2. No
            </span>
            <br>
            <span style="margin-left:2%">
              <input type="number" name="Packyear"> Packyear
            </span>
          </td>
        </tr>

        <!--Row 22-->
        <tr>
          <td>Alcohol </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Alcohol">1. Yes 
            <input type="radio" value="no" name="Alcohol">2. No
          </td>
        </tr>

        <!--Row 23-->
        <tr>
          <td>Exercise </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Exercise">1. Yes 
            <input type="radio" value="no" name="Exercise">2. No
          </td>
        </tr>

        <!--Row 24-->
        <tr>
          <td>Herbal </td>
          <td colspan="3">
            <input type="radio" value="yes" name="Herbal">1. Yes 
            <input type="radio" value="no" name="Herbal">2. No
          </td>
        </tr>

      </table>
    </section> <!---End section 1--->

    <section id="section2"> <!----------------- Section 2 ----------------->
      <table>
        <!--Part II-->
        <caption>Part II: Acute kidney injury</caption>

          <!--Row 1-->
        <tr>
          <td>Diagnosis of AKI</td>
          <td colspan="4">
            <input type="radio" value="Creatinine criteria" name="Diagnosis of AKI">1. Creatinine criteria 
            <input type="radio" value="Urine output criteria" name="Diagnosis of AKI">2. Urine output criteria
            <input type="radio" value="Both" name="Diagnosis of AKI">3. Both
        </tr>

          <!--Row 2-->
        <tr>
          <td>AKI staging</td>
          <td colspan="4">
            <input type="radio" value="Stage 1" name="AKI staging">Stage 1 
            <input type="radio" value="Stage 2" name="AKI staging">Stage 2
            <input type="radio" value="Stage 3" name="AKI staging">Stage 3
        </tr>

        <!--Row 3-->
        <tr>
          <td>Etiology of AKI</td>
          <td colspan="4">
            <input type="radio" value="Ischemic" name="Ischemic">1. Ischemic 
            <input type="radio" value="Sepsis" name="Sepsis">2. Sepsis
            <input type="radio" value="Cardiorenal" name="Cardiorenal">3. Cardiorenal
            <input type="radio" value="Nephrotoxic/MALA" name="Nephrotoxic/MALA">4. Nephrotoxic/MALA
            <input type="radio" value="Obstructive uropathy" name="Obstructive uropathy">5. Obstructive uropathy
            <input type="radio" value="Systemic disease/GN" name="Systemic disease/GN">6. Systemic disease/GN
            <input type="radio" value="Multifactorial" name="Multifactorial">7. Multifactorial
            <input type="radio" value="Other" name="Other2">8. Other
            <input type="text" name="Etiology-Other">

            <!----Other have same name as other in part I---->
        </tr>

        <!--Row 4-->
        <tr>
          <td>RRT</td>
          <td colspan="4">
            <input type="radio" value="yes" name="RRT">1. Yes 
            <input type="radio" value="no" name="RRT">0. No
            <hr>
            <p>First Mode of RRT</p>
            <input type="radio" value="HD" name="First Mode of RRT">1. HD
            <input type="radio" value="PD" name="First Mode of RRT">2. PD
            <input type="radio" value="CRRT" name="First Mode of RRT">3. CRRT
            <hr>
            <p>Indication for RRT</p>
            <input type="checkbox" value="yes" name="Acidosis">1. Acidosis
            <input type="checkbox" value="yes" name="Hyperkalemia">2. Hyperkalemia
            <input type="checkbox" value="yes" name="Intoxication">3. Intoxication
            <input type="checkbox" value="yes" name="Volume overload/control">4. Volume overload/control
            <input type="checkbox" value="yes" name="Uremia">5. Uremia
            <input type="checkbox" value="yes" name="Other3">6. Other
            <input type="text" name="Indication-Other">

            <!----Other have same name as other in part I---->
        </tr>
        <tr class="smallfont">
          <td>Renal function</td>
          <td>Baseline</td>
          <td>Admission</td>
          <td>Maximum</td>
          <td>Discharge</td>
        </tr>
        <tr style="text-align:center">
          <td style="text-align:left">Creatinine
            (mg/dl)</td>
          <td><input type="number" step="0.01" name="Creatinine-Baseline"></td>
          <td><input type="number" step="0.01" name="Creatinine-Admission"></td>
          <td><input type="number" step="0.01" name="Creatinine-Maximum"></td>
          <td><input type="number" step="0.01" name="Creatinine-Discharge"></td>
        </tr>
        <tr style="text-align:center">
          <td style="text-align:left">GFR <span class="smallfont">(ml/min/1.73m2)</span></td>
          <td><input type="number" step="0.01" name="GFR-Baseline"></td>
          <td><input type="number" step="0.01" name="GFR-Admission"></td>
          <td><input type="number" step="0.01" name="GFR-Maximum"></td>
          <td><input type="number" step="0.01" name="GFR-Discharge"></td>
        </tr>
        <tr style="text-align:center">
          <td style="text-align:left">UACR</td>
          <td><input type="number" step="0.01" name="UACR-Baseline"></td>
          <td><input type="number" step="0.01" name="UACR-Admission"></td>
          <td><input type="number" step="0.01" name="UACR-Maximum"></td>
          <td><input type="number" step="0.01" name="UACR-Discharge"></td>
        </tr>
      </table>
    </section> 
    <!--------------End section 2--------------->


    <section id="section3" class="hidden">
      <table id="tableWildcard">
        <caption>
          Part III: Follow up
        </caption>
        <!-----------1st row------------>
        <tr style="text-align: center">
          <td></td>
          <td><span id="s3th1">1stvisit</span><br><input type="text"></td>
          <td><span id="s3th2">3mo</span><br><input type="text"></td>
          <td><span id="s3th3">6mo</span><br><input type="text"></td>
          <td><span id="s3th4">9mo</span><br><input type="text"></td>
          <td><span id="s3th5">12mo</span><br><input type="text"></td>
          <td><span id="s3th6">15mo</span><br><input type="text"></td>
          <td><span id="s3th7">18mo</span><br><input type="text"></td>
          <td><span id="s3th8">24mo</span><br><input type="text"></td>
          <td>
            <input id="s3th9" type="text" placeholder="()" style="margin: 0 auto"><br><input type="text">
          </td>
          <td>
            <input id="s3th10" type="text" placeholder="()" style="margin: 0 auto"><br><input type="text">
          </td>

        </tr>
        <!-------End of 1st row-------->
        <!--Auto add row (function createTable)--->
      </table>
    </section>
    <section id="section4"></section>

    <div class="button-container">
        <button type="submit" id="submit-button">Send</button>
    </div>
    </form>
    <div
      id="message"
      style="
        display: none;
        position: fixed;
        top: 10px;
        right: 10px;
        font-weight: bold;
        color: green;
        padding: 8px;
        background-color: beige;
        border-radius: 4px;
        border-color: aquamarine;
      "
    ></div>
  </body>
    
    <script>
      document.getElementById("form").addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent the default form submission
        document.getElementById("message").textContent = "Submitting..";
        document.getElementById("message").style.display = "block";
        document.getElementById("submit-button").disabled = true;

        // Collect the form data
        var formData = new FormData(this);
        var keyValuePairs = [];
        for (var pair of formData.entries()) {
          keyValuePairs.push(pair[0] + "=" + pair[1]);
        }

        var formDataString = keyValuePairs.join("&");

        // Send a POST request to your Google Apps Script
        fetch(
          "https://script.google.com/macros/s/AKfycbyqOv7uEOaR6sYX49q4QYMGLoy1NrmiJIgc11lQM3uUWJyfkcxZef8nX-6SrpnxzTrwaA/exec",
          {
            redirect: "follow",
            method: "POST",
            body: formDataString,
            headers: {
              "Content-Type": "text/plain;charset=utf-8",
            },
          }
        )
          .then(function (response) {
            // Check if the request was successful
            if (response) {
              return response; // Assuming your script returns JSON response
            } else {
              throw new Error("Failed to submit the form.");
            }
          })
          .then(function (data) {
            // Display a success message
            document.getElementById("message").textContent =
              "Data submitted successfully!";
            document.getElementById("message").style.display = "block";
            document.getElementById("message").style.backgroundColor = "green";
            document.getElementById("message").style.color = "beige";
            document.getElementById("submit-button").disabled = false;
            document.getElementById("form").reset();

            setTimeout(function () {
              document.getElementById("message").textContent = "";
              document.getElementById("message").style.display = "none";
            }, 2600);
          })
          .catch(function (error) {
            // Handle errors, you can display an error message here
            console.error(error);
            document.getElementById("message").textContent =
              "An error occurred while submitting the form.";
            document.getElementById("message").style.display = "block";
          });
      });

      //script to control section
      let sectionN = 4;
      const sec = [];
      const btn = [];
      
      for(let i=0;i<sectionN;i++){
        sec.push(document.getElementById(`section${i+1}`));
        btn.push(document.getElementById(`page-btn${i+1}`));
        btn[i].addEventListener('click',()=>{
          for(let j = 0; j< sec.length;j++) //hide every other section
          {
            if(sec[j].classList.contains("hidden") == false){
              sec[j].classList.add("hidden");
            }
          }
          sec[i].classList.remove("hidden"); //show the section that btn pressed
        });
      }


    //set default date
    const dateInputArr = document.querySelectorAll('input[type="date"]')
    for(let i =0;i<dateInputArr.length;i++){
      dateInputArr[i].defaultValue = "1980-06-15";
    }

    //auto create new row
    const TBwildcard = document.getElementById("tableWildcard");
    const createTable = (TBhead,TBstep="0.1") => {
        return `<tr>
          <td id=${TBhead}>${TBhead}</td>
          <td><input type="number" name="${TBhead}-1stvisit" step=${TBstep} id="${TBhead}-1stvisit" step=${TBstep}></td>
          <td><input type="number" name="${TBhead}-3mo" step=${TBstep} id="${TBhead}-3mo"></td>
          <td><input type="number" name="${TBhead}-6mo" step=${TBstep} id="${TBhead}-6mo"></td>
          <td><input type="number" name="${TBhead}-9mo" step=${TBstep} id="${TBhead}-9mo"></td>
          <td><input type="number" name="${TBhead}-12mo" step=${TBstep} id="${TBhead}-12mo"></td>
          <td><input type="number" name="${TBhead}-15mo" step=${TBstep} id="${TBhead}-15mo"></td>
          <td><input type="number" name="${TBhead}-18mo" step=${TBstep} id="${TBhead}-18mo"></td>
          <td><input type="number" name="${TBhead}-24mo" step=${TBstep} id="${TBhead}-24mo"></td>
          <td><input type="number" name="${TBhead}-extra1" step=${TBstep} id="${TBhead}-extra1"></td>
          <td><input type="number" name="${TBhead}-extra2" step=${TBstep} id="${TBhead}-extra2"></td>
        </tr>`;
    }

    //create row for section 3
    TBwildcard.innerHTML += createTable("BW");
    document.getElementById("BW").innerText+=" (kg)";
    TBwildcard.innerHTML += createTable("SBP");
    document.getElementById("SBP").innerText+=" (mmHg)";
    TBwildcard.innerHTML += createTable("DBP");
    document.getElementById("DBP").innerText+=" (mmHg)";
    TBwildcard.innerHTML += createTable("MAP");
    document.getElementById("MAP").innerText+=" (mmHg)";
    document.getElementById("MAP").innerHTML+="<button type='button' id='MAP-btn'>MAP</button>";
    TBwildcard.innerHTML += createTable("BUN");
    TBwildcard.innerHTML += createTable("Cr");
    TBwildcard.innerHTML += createTable("eGFR");
    TBwildcard.innerHTML += createTable("Na");
    TBwildcard.innerHTML += createTable("K");
    TBwildcard.innerHTML += createTable("Cl");
    TBwildcard.innerHTML += createTable("HCO3");
    TBwildcard.innerHTML += createTable("Ca");
    TBwildcard.innerHTML += createTable("PO4");
    TBwildcard.innerHTML += createTable("Hb");
    TBwildcard.innerHTML += createTable("Hct");
    TBwildcard.innerHTML += createTable("FBG");
    TBwildcard.innerHTML += createTable("HbA1c");
    TBwildcard.innerHTML += createTable("Cho");
    TBwildcard.innerHTML += createTable("LDL");
    TBwildcard.innerHTML += createTable("Alb");
    TBwildcard.innerHTML += createTable("Vit D");
    TBwildcard.innerHTML += createTable("iPTH");
    TBwildcard.innerHTML += createTable("Iron");
    TBwildcard.innerHTML += createTable("TIBC");
    TBwildcard.innerHTML += createTable("Ferritin");
    TBwildcard.innerHTML += createTable("UACR");
    TBwildcard.innerHTML += createTable("24-h urine Na");
    TBwildcard.innerHTML += createTable("Prot intake");

    //Auto set MAP
    const autoSetMAP = (n) => {
      for(let i=0;i<n;i++){
        let sbp = 0;
        let dbp = 0;
        let map;
        let thtext = "";
        let fixHeader = 8; // 8 come from amount of fixed header (1stvisit to 24mo)
        if(i<fixHeader){ 
          thtext = document.getElementById(`s3th${i+1}`).textContent;
          sbp = document.getElementById(`SBP-${thtext}`)?.value?document.getElementById(`SBP-${thtext}`)?.value:0;
        dbp = document.getElementById(`DBP-${thtext}`)?.value?document.getElementById(`DBP-${thtext}`)?.value:0;
        map = document.getElementById(`MAP-${thtext}`);
        }else{
          sbp = document.getElementById(`SBP-extra${i-fixHeader+1}`)?.value?document.getElementById(`SBP-extra${i-fixHeader+1}`)?.value:0;
        dbp = document.getElementById(`SBP-extra${i-fixHeader+1}`)?.value?document.getElementById(`SBP-extra${i-fixHeader+1}`)?.value:0;
        map = document.getElementById(`MAP-extra${i-fixHeader+1}`);
        //call extra1, extra2 element
        }

        if(map){
          map.value=(parseInt(sbp)+(parseInt(dbp)*2))/3;
        }
      }
    }
    document.getElementById("MAP-btn").addEventListener('click',()=>{autoSetMAP(10)});
    </script>
</html>
